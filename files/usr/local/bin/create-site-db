#!/bin/sh

account=$(echo -n $1 | cut -f1 -d':')
sitename=$(echo -n $1 | cut -f2 -d':')
shift

if [ x"$account" != x$(id -un $account 2>/dev/null) ]; then
	echo "$0 ACCOUNT[:SITENAME] mysql_args_to_connect_to_server"
	exit 1
fi

[ x"$account" == x"$sitename" ] && sitename=

cat << EOF | /opt/mysql/current/bin/mysql $*
CREATE DATABASE IF NOT EXISTS $sitename${sitename:+_}live_drupal;
GRANT ALL PRIVILEGES ON \`$sitename${sitename:+\\_}live\_drupal\`.* TO '$account'@'%' WITH GRANT OPTION;
CREATE DATABASE IF NOT EXISTS $sitename${sitename:+_}qa_drupal;
GRANT ALL PRIVILEGES ON \`$sitename${sitename:+\\_}qa\_drupal\`.* TO '$account'@'%' WITH GRANT OPTION;
CREATE DATABASE IF NOT EXISTS $sitename${sitename:+_}dev_drupal;
GRANT ALL PRIVILEGES ON \`$sitename${sitename:+\\_}dev\_drupal\`.* TO '$account'@'%' WITH GRANT OPTION;
CREATE DATABASE IF NOT EXISTS $sitename${sitename:+_}live_civicrm;
GRANT ALL PRIVILEGES ON \`$sitename${sitename:+\\_}live\_civicrm\`.* TO '$account'@'%' WITH GRANT OPTION;
CREATE DATABASE IF NOT EXISTS $sitename${sitename:+_}qa_civicrm;
GRANT ALL PRIVILEGES ON \`$sitename${sitename:+\\_}qa\_civicrm\`.* TO '$account'@'%' WITH GRANT OPTION;
CREATE DATABASE IF NOT EXISTS $sitename${sitename:+_}dev_civicrm;
GRANT ALL PRIVILEGES ON \`$sitename${sitename:+\\_}dev\_civicrm\`.* TO '$account'@'%' WITH GRANT OPTION;
EOF
