#!/bin/bash

usage() {
  echo "Usage: `basename "$0"` <-d git_dir>

  Options:
    -d git_dir            git dir to use

  This script is used to create the master and develop branches on a git
  repo in case any of it doesn't exist
"
  exit 1

}

[ $# -eq 0 ] && usage

getopt_flags="d:"
while getopts $getopt_flags OPTF; do
  case $OPTF in
    d)
      git_dir="$OPTARG"
      if [ ! -e "$git_dir" ]; then
        echo "Error: dir '$git_dir' doesn't exist." 1>&2
        exit 1
      elif [ ! -d "$git_dir" ]; then
        echo "Error: path '$git_dir' is not a directory" 1>&2
        exit 1
      fi
      ;;
    *)
      usage
      ;;
  esac
done
[ $OPTIND -gt 1 ] && shift $(( $OPTIND - 1 ))

if [ ! -e "$git_dir/refs/heads" ]; then
  echo "Error: path '$git_dir' doesn't look like a git dir" 1>&2
  exit 1
fi

if [ ! -e "$git_dir/refs/heads/master" ]; then
  GIT_DIR="$git_dir" git branch master
  if [ $? -ne 0 ]; then
    echo "Error: unable to create branch 'master'" 1>&2
    exit 1
  fi
fi

if [ ! -e "$git_dir/refs/heads/develop" ]; then
  GIT_DIR="$git_dir" git branch develop
  if [ $? -ne 0 ]; then
    echo "Error: unable to create branch 'developer'" 1>&2
    exit 1
  fi
fi
